# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ (Streaming)

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ ‚úÖ

1. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏** –≤ `conversationEngine.js`
   - –í–∏–¥–Ω–æ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ Gemini –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
   
2. ‚úÖ **–°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å –ø–æ—Ç–æ–∫–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** `utils/streamingEngine.js`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `generateContentStream()` –æ—Ç Gemini
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –ø–æ—Ä—Ü–∏—è–º–∏ –ø–æ 2-3 —Å–ª–æ–≤–∞
   
3. ‚úÖ **–°–æ–∑–¥–∞–Ω WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** `handlers/mediaStreamHandler.js`
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Twilio Media Streams
   - –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞
   
4. ‚úÖ **–û–±–Ω–æ–≤–ª—ë–Ω `answer_phone.js`**
   - WebSocket —Å–µ—Ä–≤–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π HTTP —Å–µ—Ä–≤–µ—Ä
   - –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Cloudflare –Ω–∞ –ø—É—Ç–∏ `/ws`
   - –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `/voice-stream` –∏ `/stream-message`
   
5. ‚úÖ **–£–±—Ä–∞–Ω–∞ –º—É–∑—ã–∫–∞ –Ω–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–∏**
   - –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –ø–∞—É–∑–∞ –≤ 1 —Å–µ–∫—É–Ω–¥—É
   
6. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`**
   - `WS_URL=wss://api.leadertechnology.shop/ws`
   - `DOMAIN_NAME=api.leadertechnology.shop`
   - `PORT=1337`

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
npm install
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
npm start
```

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
‚úÖ TwiML HTTPS server running for domain api.leadertechnology.shop on port 1337
üîå WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ api.leadertechnology.shop/ws (—á–µ—Ä–µ–∑ Cloudflare)
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (—Ç–µ–∫—É—â–∏–π)
**Twilio Webhook URL:** `https://api.leadertechnology.shop/voice`

–≠—Ç–æ —Å—Ç–∞—Ä—ã–π —Ä–µ–∂–∏–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ~9 —Å–µ–∫—É–Ω–¥.

### –í–∞—Ä–∏–∞–Ω—Ç 2: Streaming —Ä–µ–∂–∏–º (–Ω–æ–≤—ã–π) ‚ö°
**Twilio Webhook URL:** `https://api.leadertechnology.shop/voice-stream`

–≠—Ç–æ –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ~0.5-1 —Å–µ–∫—É–Ω–¥–∞.

---

## –ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º:
```
üì® [VOICE] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç +972533403449: "◊©◊ú◊ï◊ù"
‚è±Ô∏è RAG + CRM Task: 234ms
‚è±Ô∏è Gemini API Call: 1.2s
‚è±Ô∏è –í–†–ï–ú–Ø –û–¢–í–ï–¢–ê GEMINI: 1.52 —Å–µ–∫—É–Ω–¥
‚è±Ô∏è Total Response Time [voice]: 1.6s
```

### Streaming —Ä–µ–∂–∏–º:
```
üì® [STREAMING] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç +972533403449: "◊©◊ú◊ï◊ù"
‚è±Ô∏è RAG + CRM Task: 234ms
‚ö° –ü–ï–†–í–´–ô –ß–ê–ù–ö –ü–û–õ–£–ß–ï–ù: 0.45 —Å–µ–∫—É–Ω–¥  üëà –í–ê–ñ–ù–û!
üîä –û—Ç–ø—Ä–∞–≤–∫–∞ —á–∞–Ω–∫–∞ #1: "◊©◊ú◊ï◊ù ◊ï◊ë◊®◊ï◊õ◊ô◊ù"
üîä –û—Ç–ø—Ä–∞–≤–∫–∞ —á–∞–Ω–∫–∞ #2: "◊î◊ë◊ê◊ô◊ù ◊ú◊ó◊ë◊®◊™"
‚è±Ô∏è –ü–û–õ–ù–û–ï –í–†–ï–ú–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò: 1.23 —Å–µ–∫—É–Ω–¥
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å:** `npm start`
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–æ–≤
3. **–ü–æ–∑–≤–æ–Ω–∏—Ç—å –Ω–∞ –±–æ—Ç–∞** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
4. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å Twilio Webhook** –Ω–∞ `/voice-stream` –¥–ª—è streaming —Ä–µ–∂–∏–º–∞
5. **–°—Ä–∞–≤–Ω–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É** - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ!

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

‚úÖ **Cloudflare –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç WebSocket** —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç 443 (HTTPS).

‚úÖ **WebSocket –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –ø—É—Ç–∏** `wss://api.leadertechnology.shop/ws` - –Ω–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ!

‚ö†Ô∏è **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ Cloudflare.

‚ö†Ô∏è **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ü–µ–ø—Ü–∏—é. –î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ:
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Google Cloud TTS –∏–ª–∏ Twilio TTS API
- –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–æ–≤ —á–µ—Ä–µ–∑ WebSocket

---

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 1337:
   ```bash
   netstat -an | findstr 1337
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ WebSocket

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Cloudflare –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç WebSocket (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö)

4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º `/voice` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
