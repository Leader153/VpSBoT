# โ ะะกะะะะะะะะะฏ ะะะฏ CLOUDFLARE

## ะัะพะฑะปะตะผะฐ
ะะทะฝะฐัะฐะปัะฝะพ WebSocket ะฑัะป ะฝะฐัััะพะตะฝ ะฝะฐ ะพัะดะตะปัะฝัะน ะฟะพัั 8080, ััะพ ะฝะต ัะฐะฑะพัะฐะตั ัะตัะตะท Cloudflare.

## ะะตัะตะฝะธะต
WebSocket ัะตะฟะตัั ัะฐะฑะพัะฐะตั ะฝะฐ ัะพะผ ะถะต HTTP ัะตัะฒะตัะต ัะตัะตะท ะฟััั `/ws`, ััะพ ะฟะพะทะฒะพะปัะตั Cloudflare ะบะพััะตะบัะฝะพ ะฟัะพะบัะธัะพะฒะฐัั ัะพะตะดะธะฝะตะฝะธั.

---

## ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั

### 1. `.env`
**ะัะปะพ:**
```env
WS_PORT=8080
WS_URL=wss://api.leadertechnology.shop:8080
```

**ะกัะฐะปะพ:**
```env
# Cloudflare ะฟัะพะบัะธััะตั WebSocket ัะตัะตะท ััะฐะฝะดะฐััะฝัะน ะฟะพัั 443
WS_URL=wss://api.leadertechnology.shop/ws
```

---

### 2. `handlers/answer_phone.js`

**ะัะปะพ:**
```javascript
const wsPort = process.env.WS_PORT || 8080;
const wss = new WebSocket.Server({ port: wsPort });
console.log(`๐ WebSocket ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ ะฟะพััั ${wsPort}`);
```

**ะกัะฐะปะพ:**
```javascript
// WebSocket ะฝะฐ ัะพะผ ะถะต HTTP ัะตัะฒะตัะต (ะดะปั Cloudflare)
const wss = new WebSocket.Server({ 
    server: httpServer,  // ะัะธะฒัะทัะฒะฐะตะผ ะบ ะพัะฝะพะฒะฝะพะผั ัะตัะฒะตัั
    path: '/ws'          // ะะพัััะฟะตะฝ ะฟะพ ะฟััะธ /ws
});
console.log(`๐ WebSocket ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ ${domain}/ws (ัะตัะตะท Cloudflare)`);
```

**ะ ะฒ ัะฝะดะฟะพะธะฝัะต `/voice-stream`:**
```javascript
// ะัะปะพ:
const wsUrl = process.env.WS_URL || `wss://${domain}:${wsPort}`;

// ะกัะฐะปะพ:
const wsUrl = process.env.WS_URL || `wss://${domain}/ws`;
```

---

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

```
โโโโโโโโโโโโโโโโโโโ
โ   Twilio        โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ WSS ัะพะตะดะธะฝะตะฝะธะต
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Cloudflare            โ
โ   (ะฟะพัั 443)            โ
โโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
         โ
         โ ะัะพะบัะธััะตั ะฝะฐ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   ะะฐั ัะตัะฒะตั            โ
โ   api.leadertechnology  โ
โ   (ะฟะพัั 1337)           โ
โ                         โ
โ   HTTP Server           โ
โ   โโโ /voice            โ
โ   โโโ /voice-stream     โ
โ   โโโ /ws (WebSocket)   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ะะฐะถะฝะพ!

โ **ะะธะบะฐะบะธั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะฟะพััะพะฒ ะพัะบััะฒะฐัั ะฝะต ะฝัะถะฝะพ**
โ **Cloudflare ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะพะบัะธััะตั WebSocket**
โ **SSL ัะตััะธัะธะบะฐั ัะถะต ะฝะฐัััะพะตะฝ ัะตัะตะท Cloudflare**

---

## ะัะพะฒะตัะบะฐ

ะะพัะปะต ะทะฐะฟััะบะฐ `npm start` ะฒั ะดะพะปะถะฝั ัะฒะธะดะตัั:

```
โ TwiML HTTPS server running for domain api.leadertechnology.shop on port 1337
๐ WebSocket ัะตัะฒะตั ะทะฐะฟััะตะฝ ะฝะฐ api.leadertechnology.shop/ws (ัะตัะตะท Cloudflare)
```

---

## Twilio Webhook URL

**ะะปั streaming ัะตะถะธะผะฐ ัััะฐะฝะพะฒะธัะต:**
```
https://api.leadertechnology.shop/voice-stream
```

Twilio ะฑัะดะตั ะฟะพะดะบะปััะฐัััั ะบ WebSocket ะฟะพ ะฐะดัะตัั:
```
wss://api.leadertechnology.shop/ws
```

Cloudflare ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะพะบัะธััะตั ััะพ ัะพะตะดะธะฝะตะฝะธะต ะฝะฐ ะฒะฐั ัะตัะฒะตั! ๐
